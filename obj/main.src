; Zilog eZ80 ANSI C Compiler Release 3.4
; -optsize -noreduceopt -nomodsect -peephole -globalopt
; -localcse -const=ROM 
	FILE	"SRC\MAIN.C"
	.assume ADL=1
	SEGMENT DATA
_xPos:
	DW	100
	DB	0
_yPos:
	DW	100
	DB	0
_squareSize:
	DW	10
	DB	0
_speed:
	DW	6
	DB	0
	SEGMENT BSS
_key:
	DS	1
	SEGMENT DATA
_fruitX:
	DW	0
	DB	0
_fruitY:
	DW	0
	DB	0
_segments:
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
	DW	0
	DB	0
_noSegments:
	DW	1
	DB	0
_maxSegments:
	DW	300
	DB	0
	SEGMENT BSS
_debugBuffer:
	DS	20
	SEGMENT DATA
_i:
	DW	0
	DB	0
_hasLost:
	DB	0
_frames:
	DL	0
	SEGMENT BSS
_currentDir:
	DS	3
;    1	/*
;    2	 *--------------------------------------
;    3	 * Program Name: Snake for CE
;    4	 * Author: Malcolm Anderson
;    5	 * License: uuhhhhh idk
;    6	 * Description: It's Snake. For the CE.
;    7	 *--------------------------------------
;    8	*/
;    9	
;   10	/* Keep these headers */
;   11	#include <stdbool.h>
;   12	#include <stddef.h>
;   13	#include <stdint.h>
;   14	#include <tice.h>
;   15	
;   16	/* Standard headers (recommended) */
;   17	#include <math.h>
;   18	#include <stdio.h>
;   19	#include <stdlib.h>
;   20	#include <string.h>
;   21	
;   22	#include <graphx.h>
;   23	#include <debug.h>
;   24	#include <keypadc.h>
;   25	
;   26	#define SCREEN_MAX_X 320
;   27	#define SCREEN_MAX_Y 240
;   28	
;   29	/* Put your function prototypes here */
;   30	void generateFruit(void);
;   31	void shiftSegments(void);
;   32	/* Put all your globals here */
;   33	
;   34	int xPos = 100;
;   35	int yPos = 100;
;   36	int squareSize = 10;
;   37	int speed = 6;
;   38	kb_key_t key;
;   39	
;   40	int fruitX = 0;
;   41	int fruitY = 0;
;   42	
;   43	int segments[2][300] = 0;
;   44	unsigned int noSegments = 1;
;   45	unsigned int maxSegments = 300;
;   46	char debugBuffer[20];
;   47	
;   48	int i = 0; // for iterations
;   49	
;   50	unsigned char hasLost = 0;
;   51	
;   52	unsigned long int frames = 0;
;   53	
;   54	enum Direction {
;   55	    Up = 0,
;   56	    Right = 1,
;   57	    Down = 2,
;   58	    Left = 3
;   59	};
;   60	
;   61	enum Direction currentDir;
	SEGMENT CODE
;   62	
;   63	void main(void) {
_main:
	LD	HL,-39
	CALL	__frameset
;   64	    currentDir = Right;
	LD	BC,1
	LD	(_currentDir),BC
;   65	
;   66	    
;   67	    /* Fill in the body of the main function here */
;   68	
;   69	    gfx_Begin();
	CALL	_gfx_Begin
;   70	    gfx_SetDrawBuffer();
	LD	BC,1
	PUSH	BC
	CALL	_gfx_SetDraw
	POP	BC
;   71	    gfx_SetColor(gfx_white);
	LD	BC,255
	PUSH	BC
	CALL	_gfx_SetColor
	POP	BC
;   72	    gfx_SetTextFGColor(gfx_white);
	LD	BC,255
	PUSH	BC
	CALL	_gfx_SetTextFGColor
	POP	BC
;   73	
;   74	    generateFruit();
	CALL	_generateFruit
;   75	
;   76	
;   77	
;   78	
;   79	    
;   80	    kb_Scan();
	CALL	_kb_Scan
;   81	
;   82	    do {
L_55:
;   83	        frames++;
	LD	A,(_frames+3)
	LD	E,A
	LD	A,1
	LD	HL,(_frames)
;   84	        gfx_FillScreen(gfx_black);
	LD	BC,0
	PUSH	BC
	CALL	__ladd_b
	LD	(_frames),HL
	LD	A,E
	LD	(_frames+3),A
	CALL	_gfx_FillScreen
	POP	BC
;   85	        // gfx_SetTextFGColor(gfx_white);
;   86	
;   87	        // sprintf(debugBuffer, "%d segments", noSegments);
;   88	        // // debugBuffer[0] = 'A';
;   89	        // // debugBuffer[1] = 'B';
;   90	        // // debugBuffer[2] = 'C';
;   91	        // /* Print some scaled font */
;   92	        // gfx_SetTextScale(2, 2);
;   93	        // //gfx_PrintStringXY("This text is SCALED!!", 15, 10);
;   94	        // gfx_PrintStringXY("ahoy", (LCD_WIDTH - gfx_GetStringWidth("ahoy")) / 2, (LCD_HEIGHT - 8) / 2);
;   95	        dbg_sprintf(dbgout, debugBuffer);
;   96	        gfx_SetColor(gfx_white);
	LD	BC,255
	PUSH	BC
	CALL	_gfx_SetColor
	POP	BC
;   97	
;   98	        // for (i = noSegments - 1; i >= 0; i--) {
;   99	        //     gfx_SetColor(i);
;  100	        //     gfx_FillRectangle(segments[0][i], segments[1][i], squareSize, squareSize);
;  101	        // }
;  102	
;  103	        for (i = 0; i < noSegments; i++) {
	LD	BC,0
	LD	(_i),BC
	JR	L_6
L_4:
;  104	            //gfx_SetColor(i * 5);
;  105	            // gfx_SetColor(gfx_white);
;  106	            gfx_FillRectangle(segments[0][i], segments[1][i], squareSize, squareSize);   
	LD	HL,(_i)
	LD	BC,HL
	ADD	HL,HL
	ADD	HL,BC
	LD	BC,HL
	LD	HL,_segments
	LD	DE,900
	ADD	HL,DE
	ADD	HL,BC
	LD	DE,(HL)
	LD	HL,(_squareSize)
	PUSH	HL
	LD	HL,BC
	LD	BC,(_squareSize)
	PUSH	BC
	PUSH	DE
	LD	BC,_segments
	ADD	HL,BC
	LD	BC,(HL)
	PUSH	BC
	CALL	_gfx_FillRectangle
	POP	BC
	POP	BC
	POP	BC
	POP	BC
	LD	BC,(_i)
	INC	BC
	LD	(_i),BC
;  107	        }
L_6:
	LD	BC,(_noSegments)
	LD	HL,(_i)
	OR	A,A
	SBC	HL,BC
	JR	C,L_4
;  108	
;  109	        gfx_SetColor(gfx_yellow);
	LD	BC,231
	PUSH	BC
	CALL	_gfx_SetColor
	POP	BC
;  110	        gfx_FillCircle(fruitX, fruitY, squareSize / 2);
	LD	HL,(_squareSize)
	LD	BC,2
	CALL	__idivs
	PUSH	HL
	LD	BC,(_fruitY)
	PUSH	BC
	LD	BC,(_fruitX)
	PUSH	BC
	CALL	_gfx_FillCircle
	POP	BC
	POP	BC
	POP	BC
;  111	
;  112	        /* Update kb_Data */
;  113	        kb_Scan();
	CALL	_kb_Scan
;  114	
;  115	        /* Load group 7 registers */
;  116	        key = kb_Data[7];
	LD	A,(16056350)
;  117	
;  118	        switch (key) {
	UEXT	HL
	LD	L,A
	LD	(_key),A
	CALL	__case8
L__1:
	DW	4
	DB	1
	DW24	L_8	

	DB	2
	DW24	L_17	

	DB	4
	DW24	L_11	

	DB	8
	DW24	L_14	

	DW24	L_26	

;  119	            case kb_Down:
L_8:
;  120	                if (currentDir != Up) currentDir = Down;
	LD	HL,(_currentDir)
	CALL	__icmpzero
	JR	Z,L_26
	LD	BC,2
	LD	(_currentDir),BC
;  121	                break;
	JR	L_26
;  122	            case kb_Right:
L_11:
;  123	                if (currentDir != Left) currentDir = Right;
	LD	BC,3
	LD	HL,(_currentDir)
	OR	A,A
	SBC	HL,BC
	JR	Z,L_26
	LD	BC,1
	LD	(_currentDir),BC
;  124	                break;
	JR	L_26
;  125	            case kb_Up:
L_14:
;  126	                if (currentDir != Down) currentDir = Up;
	LD	BC,2
	LD	HL,(_currentDir)
	OR	A,A
	SBC	HL,BC
	JR	Z,L_26
	LD	BC,0
	LD	(_currentDir),BC
;  127	                break;
	JR	L_26
;  128	            case kb_Left:
L_17:
;  129	                if (currentDir != Right) currentDir = Left;
	LD	BC,1
	LD	HL,(_currentDir)
	OR	A,A
	SBC	HL,BC
	JR	Z,L_26
	LD	BC,3
	LD	(_currentDir),BC
;  130	                break;
;  131	            default:
;  132	                break;
;  133	        }
L_26:
;  134	
;  135	        switch ((int)currentDir)
	LD	HL,(_currentDir)
	CALL	__seqcase
L__6:
	DW	4
	DW	0
	DB	0
	DW24	L_21	

	DW24	L_22	

	DW24	L_23	

	DW24	L_24	

	DW24	L_30	

;  136	        {
;  137	        case 0: // up
L_21:
;  138	            yPos-= speed;
	LD	HL,(_yPos)
	LD	BC,(_speed)
	OR	A,A
	SBC	HL,BC
	LD	(_yPos),HL
;  139	            break;
	JR	L_30
;  140	        case 1: // Right
L_22:
;  141	            xPos+= speed;
	LD	BC,(_speed)
	LD	HL,(_xPos)
	ADD	HL,BC
	LD	(_xPos),HL
;  142	            break;
	JR	L_30
;  143	        case 2: // Down
L_23:
;  144	            yPos+= speed;
	LD	BC,(_speed)
	LD	HL,(_yPos)
	ADD	HL,BC
	LD	(_yPos),HL
;  145	            break;
	JR	L_30
;  146	        case 3: // Left
L_24:
;  147	            xPos-= speed;
	LD	HL,(_xPos)
	LD	BC,(_speed)
	OR	A,A
	SBC	HL,BC
	LD	(_xPos),HL
;  148	            break;
;  149	        default:
;  150	            break;
;  151	        }
L_30:
;  152	
;  153	        if (yPos > SCREEN_MAX_Y) {
	LD	BC,(_yPos)
	LD	HL,240
	OR	A,A
	SBC	HL,BC
	CALL	__setflag
	JP	P,L_29
;  154	            yPos = 0;
	LD	BC,0
	LD	(_yPos),BC
;  155	        } else if (yPos < 0) {
	JR	L_34
L_29:
	LD	HL,(_yPos)
	CALL	__icmpzero
	CALL	__setflag
	JP	P,L_34
;  156	            yPos = SCREEN_MAX_Y;
	LD	BC,240
	LD	(_yPos),BC
;  157	        }
L_34:
;  158	
;  159	        if (xPos > SCREEN_MAX_X) {
	LD	BC,(_xPos)
	LD	HL,320
	OR	A,A
	SBC	HL,BC
	CALL	__setflag
	JP	P,L_33
;  160	            xPos = 0;
	LD	BC,0
	LD	(_xPos),BC
;  161	        } else if (xPos < 0) {
	JR	L_35
L_33:
	LD	HL,(_xPos)
	CALL	__icmpzero
	CALL	__setflag
	JP	P,L_35
;  162	            xPos = SCREEN_MAX_X;
	LD	BC,320
	LD	(_xPos),BC
;  163	        }
L_35:
;  164	
;  165	        shiftSegments();
	CALL	_shiftSegments
;  166	        segments[0][0] = xPos;
	LD	BC,(_xPos)
	LD	(_segments),BC
;  167	        segments[1][0] = yPos;
	LD	BC,900
	LD	HL,_segments
	ADD	HL,BC
	LD	BC,(_yPos)
	LD	(HL),BC
;  168	
;  169	        for (i = 1; i < noSegments; i++) {
	LD	BC,1
	LD	(_i),BC
	JR	L_41
L_39:
;  170	            if (segments[0][0] == segments[0][i] && segments[1][0] == segments[1][i]) {
	LD	BC,_segments
	LD	(IX+-15),BC
	LD	HL,(_i)
	LD	BC,HL
	ADD	HL,HL
	ADD	HL,BC
	LD	(IX+-12),HL
	LD	BC,(IX+-15)
	ADD	HL,BC
	LD	IY,(IX+-15)
	LD	BC,(IY)
	LD	HL,(HL)
	OR	A,A
	SBC	HL,BC
	JR	NZ,L_40
	LD	BC,900
	LD	HL,_segments
	ADD	HL,BC
	LD	(IX+-18),HL
	LD	BC,(IX+-12)
	LD	HL,(IX+-18)
	ADD	HL,BC
	LD	IY,(IX+-18)
	LD	BC,(IY)
	LD	HL,(HL)
	OR	A,A
	SBC	HL,BC
	JR	NZ,L_40
;  171	                hasLost = 1;
	LD	A,1
	LD	(_hasLost),A
;  172	                break;
	JR	L_52
;  173	            }
;  174	        }
L_40:
	LD	BC,(_i)
	INC	BC
	LD	(_i),BC
L_41:
	LD	BC,(_noSegments)
	LD	HL,(_i)
	OR	A,A
	SBC	HL,BC
	JR	C,L_39
L_52:
;  175	
;  176	        if (abs(segments[0][0] - fruitX) < 10 && abs(segments[1][0] - fruitY) < 10) {
	LD	BC,_segments
	LD	(IX+-9),BC
	LD	HL,(_segments)
	LD	BC,(_fruitX)
	OR	A,A
	SBC	HL,BC
	PUSH	HL
	CALL	_abs
	POP	BC
	LD	BC,10
	OR	A,A
	SBC	HL,BC
	CALL	__setflag
	JP	P,L_53
	LD	BC,900
	LD	HL,_segments
	ADD	HL,BC
	LD	(IX+-6),HL
	LD	HL,(HL)
	LD	BC,(_fruitY)
	OR	A,A
	SBC	HL,BC
	PUSH	HL
	CALL	_abs
	POP	BC
	LD	BC,10
	OR	A,A
	SBC	HL,BC
	CALL	__setflag
	JP	P,L_53
;  177	            // speed++;
;  178	            noSegments += 3;
	LD	IY,(_noSegments)
	LEA	BC,IY+3
	LD	(_noSegments),BC
;  179	            if (noSegments >= maxSegments) {
	LD	BC,(_maxSegments)
	LD	HL,(_noSegments)
	OR	A,A
	SBC	HL,BC
	JR	NC,L_53
;  180	
;  181	            } else {
;  182	                shiftSegments();
	CALL	_shiftSegments
;  183	                segments[0][noSegments - 1] = segments[0][noSegments - 2];
	LD	IY,(_noSegments)
	LEA	BC,IY+-2
	LD	HL,3
	CALL	__imulu
	LD	BC,(IX+-9)
	ADD	HL,BC
	LD	(IX+-21),HL
	LD	IY,(_noSegments)
	LEA	BC,IY+-1
	LD	(IX+-3),BC
	LD	HL,(IX+-21)
	LD	DE,(HL)
	LD	HL,3
	CALL	__imulu
	LD	BC,HL
	LD	(IX+-36),BC	; spill
	LD	(IX+-39),BC	; spill
	LD	BC,(IX+-36)	; unspill
	LD	HL,(IX+-9)
	LD	(IX+-36),BC	; spill
	LD	BC,(IX+-39)	; unspill
	ADD	HL,BC
	LD	BC,(IX+-36)	; unspill
	LD	(HL),DE
;  184	                segments[1][noSegments - 1] = segments[0][noSegments - 2];
	LD	HL,(IX+-21)
	LD	DE,(HL)
	LD	HL,(IX+-6)
	ADD	HL,BC
	LD	(HL),DE
;  185	                switch ((int)currentDir)
	LD	HL,(_currentDir)
	CALL	__seqcase
L__17:
	DW	4
	DW	0
	DB	0
	DW24	L_43	

	DW24	L_44	

	DW24	L_45	

	DW24	L_46	

	DW24	L_48	

;  186	                {
;  187	                case 0: // up
L_43:
;  188	                    segments[1][noSegments - 1] += squareSize * 3;
	LD	HL,3
	LD	BC,(IX+-3)
	CALL	__imulu
	LD	BC,(IX+-6)
	ADD	HL,BC
	LD	(IX+-24),HL
	LD	BC,(HL)
	LD	HL,(_squareSize)
	LD	DE,HL
	LD	IY,(IX+-24)
	ADD	HL,HL
	ADD	HL,DE
	ADD	HL,BC
	LD	(IY),HL
;  189	                    // yPos--;
;  190	                    break;
	JR	L_48
;  191	                case 1: // Right
L_44:
;  192	                    segments[0][noSegments - 1] -= squareSize * 3;
	LD	HL,3
	LD	BC,(IX+-3)
	CALL	__imulu
	LD	BC,(IX+-9)
	ADD	HL,BC
	LD	(IX+-27),HL
	LD	HL,(_squareSize)
	LD	BC,HL
	ADD	HL,HL
	ADD	HL,BC
	LD	BC,HL
	LD	HL,(IX+-27)
	LD	HL,(HL)
	LD	IY,(IX+-27)
	OR	A,A
	SBC	HL,BC
	LD	(IY),HL
;  193	                    // xPos++;
;  194	                    break;
	JR	L_48
;  195	                case 2: // Down
L_45:
;  196	                    segments[1][noSegments - 1] -= squareSize * 3;
	LD	HL,3
	LD	BC,(IX+-3)
	CALL	__imulu
	LD	BC,(IX+-6)
	ADD	HL,BC
	LD	(IX+-30),HL
	LD	HL,(_squareSize)
	LD	BC,HL
	ADD	HL,HL
	ADD	HL,BC
	LD	BC,HL
	LD	HL,(IX+-30)
	LD	HL,(HL)
	LD	IY,(IX+-30)
	OR	A,A
	SBC	HL,BC
	LD	(IY),HL
;  197	                    // yPos++;
;  198	                    break;
	JR	L_48
;  199	                case 3: // Left
L_46:
;  200	                    segments[0][noSegments - 1] += squareSize * 3;
	LD	HL,3
	LD	BC,(IX+-3)
	CALL	__imulu
	LD	BC,(IX+-9)
	ADD	HL,BC
	LD	(IX+-33),HL
	LD	DE,(HL)
	LD	HL,(_squareSize)
	LD	BC,HL
	ADD	HL,HL
	ADD	HL,BC
	ADD	HL,DE
	LD	IY,(IX+-33)
	LD	(IY),HL
;  201	                    // xPos--;
;  202	                    break;
;  203	                default:
;  204	                    break;
;  205	                }
L_48:
;  206	                generateFruit();
	CALL	_generateFruit
;  207	            }
;  208	        }
L_53:
;  209	
;  210	
;  211	
;  212	
;  213	
;  214	        gfx_SwapDraw();
	CALL	_gfx_SwapDraw
;  215	        boot_WaitShort();
	CALL	_boot_WaitShort
;  216	        boot_WaitShort();
	CALL	_boot_WaitShort
;  217	        boot_WaitShort();
	CALL	_boot_WaitShort
;  218	        
;  219	
;  220	    } while (kb_Data[1] != kb_2nd && hasLost == 0);
	LD	A,(16056338)
	CP	A,32
	JR	Z,L_57
	LD	A,(_hasLost)
	OR	A,A
	JR	Z,L_55
L_57:
;  221	    gfx_End();
	CALL	_gfx_End
;  222	}
	LD	SP,IX
	POP	IX
	RET	


;**************************** _main ***************************
;Name                         Addr/Register   Size   Type
;_gfx_End                            IMPORT  -----   function
;_boot_WaitShort                     IMPORT  -----   function
;_gfx_SwapDraw                       IMPORT  -----   function
;_maxSegments                        STATIC      3   variable
;_abs                                IMPORT  -----   function
;_hasLost                            STATIC      1   variable
;_shiftSegments                      IMPORT  -----   function
;_xPos                               STATIC      3   variable
;_speed                              STATIC      3   variable
;_yPos                               STATIC      3   variable
;_key                                STATIC      1   variable
;_fruitX                             STATIC      3   variable
;_fruitY                             STATIC      3   variable
;_gfx_FillCircle                     IMPORT  -----   function
;_noSegments                         STATIC      3   variable
;_segments                           STATIC   1800   variable
;_squareSize                         STATIC      3   variable
;_gfx_FillRectangle                  IMPORT  -----   function
;_i                                  STATIC      3   variable
;_gfx_FillScreen                     IMPORT  -----   function
;_frames                             STATIC      4   variable
;_kb_Scan                            IMPORT  -----   function
;_generateFruit                      IMPORT  -----   function
;_gfx_SetTextFGColor                 IMPORT  -----   function
;_gfx_SetColor                       IMPORT  -----   function
;_gfx_SetDraw                        IMPORT  -----   function
;_gfx_Begin                          IMPORT  -----   function
;_currentDir                         STATIC      3   variable
;G_0                                  IX-12      3   variable
;G_1                                   IX-9      3   variable
;G_4                                   IX-6      3   variable
;G_5                                   IX-3      3   variable


; Stack Frame Size: 45 (bytes)
;       Spill Code: 0 (instruction)


;  223	
;  224	void generateFruit(void) {
_generateFruit:
;  225	    srand(rtc_Time());
	LD	BC,(15925316)
	PUSH	BC
	CALL	_srand
	POP	BC
;  226	    fruitX = rand() % (SCREEN_MAX_X);
	CALL	_rand
	LD	BC,320
	CALL	__irems
	LD	(_fruitX),HL
;  227	    fruitY = rand() % (SCREEN_MAX_Y);
	CALL	_rand
	LD	BC,240
	CALL	__irems
	LD	(_fruitY),HL
;  228	}
	RET	


;**************************** _generateFruit ***************************
;Name                         Addr/Register   Size   Type
;_fruitY                             STATIC      3   variable
;_fruitX                             STATIC      3   variable
;_rand                               IMPORT  -----   function
;_srand                              IMPORT  -----   function


; Stack Frame Size: 6 (bytes)
;       Spill Code: 0 (instruction)


;  229	
;  230	void shiftSegments(void) {
_shiftSegments:
	LD	HL,-39
	CALL	__frameset
;  231	    for (i = noSegments; i > 0; i--) {
	LD	BC,(_noSegments)
	LD	(_i),BC
	JR	L_63
L_61:
;  232	        segments[0][i] = segments[0][i - 1];
	LD	BC,_segments
	LD	(IX+-6),BC
	LD	DE,(_i)
	DEC	DE
	LD	BC,DE
	LD	HL,3
	CALL	__imulu
	LD	BC,HL
	LD	HL,(_i)
	LD	(IX+-12),BC	; spill
	LD	(IX+-15),HL	; spill
	LD	BC,(IX+-12)	; unspill
	ADD	HL,HL
	LD	(IX+-12),BC	; spill
	LD	BC,(IX+-15)	; unspill
	ADD	HL,BC
	LD	BC,(IX+-12)	; unspill
	LD	(IX+-9),HL
	LD	HL,(IX+-6)
	LD	(IX+-18),BC	; spill
	LD	(IX+-21),BC	; spill
	LD	BC,(IX+-18)	; unspill
	LD	(IX+-18),BC	; spill
	LD	BC,(IX+-21)	; unspill
	ADD	HL,BC
	LD	BC,(IX+-18)	; unspill
	LD	IY,HL
	LD	HL,(IX+-6)
	LD	(IX+-24),BC	; spill
	LD	BC,(IX+-9)
	LD	(IX+-27),BC	; spill
	LD	BC,(IX+-24)	; unspill
	LD	(IX+-24),BC	; spill
	LD	BC,(IX+-27)	; unspill
	ADD	HL,BC
	LD	BC,(IX+-24)	; unspill
	LD	(IX+-30),BC	; spill
	LD	BC,(IY)
	LD	(IX+-33),BC	; spill
	LD	BC,(IX+-30)	; unspill
	LD	(IX+-30),BC	; spill
	LD	BC,(IX+-33)	; unspill
	LD	(HL),BC
	LD	BC,(IX+-30)	; unspill
;  233	        segments[1][i] = segments[1][i - 1];
	LD	HL,_segments
	LD	(IX+-36),BC	; spill
	LD	BC,900
	LD	(IX+-39),BC	; spill
	LD	BC,(IX+-36)	; unspill
	LD	(IX+-36),BC	; spill
	LD	BC,(IX+-39)	; unspill
	ADD	HL,BC
	LD	BC,(IX+-36)	; unspill
	LD	(IX+-3),HL
	ADD	HL,BC
	LD	IY,HL
	LD	HL,(IX+-3)
	LD	BC,(IX+-9)
	ADD	HL,BC
	LD	BC,(IY)
	LD	(HL),BC
	LD	(_i),DE
;  234	    }
L_63:
	LD	BC,(_i)
	OR	A,A
	SBC	HL,HL
	OR	A,A
	SBC	HL,BC
	JP	M,L_61
;  235	    // segments[0][0] = xPos;
;  236	    // segments[1][0] = yPos;
;  237	}
	LD	SP,IX
	POP	IX
	RET	


;**************************** _shiftSegments ***************************
;Name                         Addr/Register   Size   Type
;_segments                           STATIC   1800   variable
;_i                                  STATIC      3   variable
;_noSegments                         STATIC      3   variable


; Stack Frame Size: 45 (bytes)
;       Spill Code: 0 (instruction)


	XREF _kb_Scan:ROM
	XREF _gfx_SetTextFGColor:ROM
	XREF _gfx_SwapDraw:ROM
	XREF _gfx_SetDraw:ROM
	XREF _gfx_FillCircle:ROM
	XREF _gfx_FillRectangle:ROM
	XREF _gfx_FillScreen:ROM
	XREF _gfx_SetColor:ROM
	XREF _gfx_End:ROM
	XREF _gfx_Begin:ROM
	XREF _abs:ROM
	XREF _rand:ROM
	XREF _srand:ROM
	XREF _boot_WaitShort:ROM
	XREF __idivs:ROM
	XREF __imulu:ROM
	XREF __irems:ROM
	XREF __frameset:ROM
	XREF __setflag:ROM
	XREF __icmpzero:ROM
	XREF __case8:ROM
	XREF __seqcase:ROM
	XREF __ladd_b:ROM
	XDEF _shiftSegments
	XDEF _generateFruit
	XDEF _main
	XDEF _currentDir
	XDEF _frames
	XDEF _hasLost
	XDEF _i
	XDEF _debugBuffer
	XDEF _maxSegments
	XDEF _noSegments
	XDEF _segments
	XDEF _fruitY
	XDEF _fruitX
	XDEF _key
	XDEF _speed
	XDEF _squareSize
	XDEF _yPos
	XDEF _xPos
	END
